<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>

        .button {
            background-color: lightblue;
            border: none;
            cursor: pointer;
        }


        div.container {
            width: 300px; /*Ширина контейнера */
            overflow-x: auto; /*Включаем горизонтальную прокрутку */
            white-space: nowrap; /*Предотвращаем перенос элементов */
        }

        div.selector {
            display: inline-block; /*Выравниваем элементы в строку */
        }

        div.item {
            display: inline-block; /*Выравниваем элементы в строку */
            width: 100px; /*Ширина элемента */
            height: 40px; /*Высота элемента */
            border-radius: 8px; /*Делаем элементы круглыми */
            background-color: lightblue; /*Цвет фона элемента */
            margin: 5px; /*Отступы между элементами */
            text-align: center; /*Центрируем текст внутри элемента */
            line-height: 40px; /*Вертикально центрируем текст */
            font-size: 18px; /*Размер текста */
            cursor: pointer; /*Меняем курсор при наведении */
        }

        /*Стили для активного элемента */
        div.item.active {
            background-color: lightgreen; /*Изменяем цвет фона */
        }
    </style>
</head>
<body>


  <form action="http://127.0.0.1:8000/book/" method="post">
        {% csrf_token %}
        Type: <input type="text" name="type" value="book_audience"><br><br>
        Token : <input type="text" name="token" ><br><br>

        Audience : <input type="text"  name="audience" id="audience_id" value="Случайная"><br><br>
        <div class="container">
            <div class="selector" id="selector_building_container">
                <!--<div class="item button" id="gk">ГК</div>
                <div class="item button" id="lk">ЛК</div>
                <div class="item button" id="digit">Цифра</div>-->
            </div>
        </div>
        <div class="container">
            <div class="selector" id="selector_container">
                <div class="item button">Случайная</div>
            </div>
        </div>

        User : <input type="text" name="user" ><br><br>
        Number bb : <input type="text" name="number_bb" ><br><br>
        Pair Number : <input type="text" name="pair_number" ><br><br>
      <input type="submit" value="Submit">
  </form>




    <script>
		var flag  = 0;
		var flag_building  = 0;
		var selected = '0';
		var building = 'ГК';

		var build_arr = (JSON.parse(httpGet('http://127.0.0.1:8000/base-info/building/?institute=%D0%9C%D0%A4%D0%A2%D0%98')));
        var aud_arr = (JSON.parse(httpGet('http://127.0.0.1:8000/base-info/audience/')));
        // var aud_arr = ["gk", "lk", "digit"];
        console.log(build_arr);
        console.log(build_arr[0]);
        console.log(build_arr[0]['name']);
        console.log(aud_arr);
        console.log(aud_arr[0]);
        console.log(aud_arr[0]['number']);

        //
        for (const item in build_arr){
            node = document.getElementById('selector_building_container');
            node.insertAdjacentHTML('afterend', `<div class="item button" id=${build_arr[item]['name']}>${build_arr[item]['name']}</div>`);

            const button = document.getElementById(`${build_arr[item]['name']}`)
            button.addEventListener('click', () => {
			    if (flag_building == 0) {
				    flag_building = 1;
				    building = `${build_arr[item]['name']}`;
			    }
			    else {
				    if (`${build_arr[item]['name']}` != building) {
				        flag_building = 1;
				        building = `${build_arr[item]['name']}`;
				    }
				    else {
				        flag_building = 0;
				        building = 'Случайная';
				        flag = 0;
				        selected = 'Случайная';
				    }
			    }
			    update_selected_building(building);
            });
        };


        for (const item in aud_arr){
            node = document.getElementById('selector_container');
            node.insertAdjacentHTML('afterend', `<div class="item button" id=${aud_arr[item]['number']}>${aud_arr[item]['number']}${aud_arr[item]['building']['name']}</div>`);

            const button = document.getElementById(`${aud_arr[item]['number']}`)
            button.addEventListener('click', () => {
                if (flag_building != 0) {
			        if (flag == 0) {
				        flag = 1;
				        selected = `${aud_arr[item]['number']}`;
			        }
			        else {
				        if (`${aud_arr[item]['number']}` != selected) {
				            flag = 1;
				            selected = `${aud_arr[item]['number']}`;
				        }
				        else {
				            flag = 0;
				            selected = 'Случайная';
				        }
			        }
			        update_selected(selected);
			    }
            });

          // Обновление нажатия аудиторий
          function update_selected(selected){
            for (const item in aud_arr){
                console.log(`${aud_arr[item]['number']}`);
                const button = document.getElementById(`${aud_arr[item]['number']}`)
                button.style.backgroundColor = 'lightblue';
                button.style.color = 'black';
                if (`${aud_arr[item]['number']}`== selected) {
                    button.style.backgroundColor = 'red';
                    button.style.color = 'white';
                }
                if (`${aud_arr[item]['building']['name']}`!= building) {
                    button.style.display = "none";
                }
                else {
                    button.style.display = "";
                }
                // display: none;
            }
            const audience_selector = document.getElementById("audience_id")
            audience_selector.value = selected;
          }
        };

        // Обновление нажатия зданий
        function update_selected_building(building){
            for (const item in build_arr){
                console.log(`${build_arr[item]['name']}`);
                const button = document.getElementById(`${build_arr[item]['name']}`)
                button.style.backgroundColor = 'lightblue';
                button.style.color = 'black';
                if (`${build_arr[item]['name']}`==building) {
                    button.style.backgroundColor = 'red';
                    button.style.color = 'white';
                }
            }
            const audience_selector = document.getElementById("audience_id")
            audience_selector.value = building;
            update_selected(selected);
          };

        // Получение денных от API BACKEND
        function httpGet(theUrl)
        {
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.open( "GET", theUrl, false );
            xmlHttp.send( null );
            return xmlHttp.responseText;
        };
    </script>


</body>
</html>




